@if (room$ | async; as room) {

  <h2>Room {{ room.id }}</h2>
  <p>Statut: {{ room.state }} ‚Äî Mode: {{ room.mode }}</p>
  <button (click)="confirmDelete()" class="danger">üóëÔ∏è Supprimer cette room</button>

  <h3>Carte temps r√©el</h3>
  <!-- ‚úÖ IMPORTANT: on passe l'id de la room √† la carte -->
  <app-room-live-map></app-room-live-map>


 

  <pre class="muted" style="white-space:pre-wrap">
  @if (room?.players) { {{ room.players | json }} } @else { no room.players }
</pre>

  <!-- ====== BOTS (monitor -> RTDB) ====== -->
  <h3>Bots (monitor ‚Üí RTDB)</h3>
  <div class="bots">
    <button (click)="addBot()">+ Ajouter un bot</button>

    <ul>
      @for (b of (bots$ | async); track b.id) {
        <li
          [class.selected]="b.id === selectedBotId"
          (click)="selectBot(b.id)">
          <strong>{{ b.displayName || b.id }}</strong>
          ‚Äî ({{ b.x ?? 0 }}, {{ b.y ?? 0 }})
          @if (b.id === selectedBotId) { <span> ‚Üê s√©lectionn√©</span> }
        </li>
      }
    </ul>

    @if (selectedBotId; as id) {
      <div class="controls">
        <p>Contr√¥les pour: <code>{{ id }}</code></p>
        <div class="pad">
          <button (click)="step(0,-1)">‚Üë</button>
          <div>
            <button (click)="step(-1,0)">‚Üê</button>
            <button (click)="step(1,0)">‚Üí</button>
          </div>
          <button (click)="step(0,1)">‚Üì</button>
        </div>
        <button (click)="toggleRandom()">Al√©atoire ON/OFF</button>
      </div>
    }
  </div>

  <h3>Positions (live ou spawn)</h3>
  <ul>
    @for (p of (positions$ | async); track p.id) {
      <li>
        <code [style.opacity]="p.isBot ? 0.7 : 1">{{ p.id }}</code>
        ‚Äî ({{ p.x | number:'1.0-2' }}, {{ p.y | number:'1.0-2' }})
        @if (p.isBot) { <span>[bot]</span> }
      </li>
    }
  </ul>

  <!-- ====== DIAGNOSTIC ====== -->
  <h3>Diagnostic droits</h3>
  <div class="diag">
    <button (click)="runDiag()">‚ñ∂ Rafra√Æchir</button>
    <button (click)="tryWriteTest()">‚úç Test √©criture bots</button>
    <ul>
      <li><b>auth.uid</b> = {{ diag.uid || '‚Äî' }}</li>
      <li><b>roomsMeta/{{ room.id }}/ownerUid</b> = {{ diag.ownerUid || '‚Äî' }}</li>
      <li><b>write bots</b> = {{ diag.canWriteBots }}</li>
    </ul>
  </div>

  <p><a [routerLink]="['/rooms']">‚Üê Retour</a></p>

} @else {
  <p>Room introuvable.</p>
}
